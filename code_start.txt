<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9 –õ–∏—Ü–µ–π - –®–∫–æ–ª—å–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .site-title {
            font-size: 24px;
            font-weight: bold;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .auth-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .login-btn {
            background: #3498db;
            color: white;
        }

        .register-btn {
            background: white;
            color: #2c3e50;
        }

        .user-btn {
            background: #27ae60;
            color: white;
        }

        .auth-btn:hover {
            opacity: 0.9;
        }

        .admin-hidden {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            background: #95a5a6;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0.3;
        }

        .admin-hidden:hover {
            opacity: 0.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 5px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .hero-section {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 5px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .hero-title {
            font-size: 36px;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .hero-subtitle {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 40px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #e74c3c;
            text-align: left;
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .feature-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .feature-description {
            color: #7f8c8d;
        }

        .section-title {
            color: #2c3e50;
            margin: 30px 0 20px;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }

        .votes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .vote-card {
            background: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .vote-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .vote-photos {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .vote-photo-item {
            text-align: center;
        }

        .vote-photo-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 3px;
            border: 1px solid #ddd;
        }

        .vote-button {
            width: 100%;
            padding: 8px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 5px;
            font-size: 13px;
        }

        .vote-button:hover:not(:disabled) {
            background: #2980b9;
        }

        .vote-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .vote-results {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
            font-size: 13px;
        }

        .vote-results-bar {
            height: 8px;
            background: #e74c3c;
            border-radius: 4px;
            margin: 5px 0;
        }

        .memes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .meme-card {
            background: white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .meme-media {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .meme-info {
            padding: 15px;
        }

        .meme-category {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .meme-description {
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .meme-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .like-button {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: white;
            cursor: pointer;
            font-size: 13px;
        }

        .like-button:hover {
            background: #fee;
        }

        .like-button.liked {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        .add-meme-card {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border: 2px dashed #bdc3c7;
            cursor: pointer;
            min-height: 300px;
        }

        .add-meme-card:hover {
            border-color: #e74c3c;
        }

        .profile-header {
            background: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        .profile-info h2 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .profile-grade {
            color: #7f8c8d;
        }

        .admin-panel {
            background: white;
            border-radius: 5px;
            padding: 20px;
        }

        .admin-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .admin-tab {
            padding: 8px 16px;
            border: none;
            background: none;
            cursor: pointer;
            color: #7f8c8d;
        }

        .admin-tab.active {
            color: #e74c3c;
            font-weight: bold;
            border-bottom: 2px solid #e74c3c;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 3px;
            color: white;
            font-weight: bold;
            z-index: 3000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.error {
            background: #e74c3c;
        }

        .user-link {
            color: #3498db;
            text-decoration: none;
            cursor: pointer;
        }

        .user-link:hover {
            text-decoration: underline;
        }

        .user-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .votes-grid,
            .memes-grid {
                grid-template-columns: 1fr;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <div class="logo">9–õ</div>
            <div class="site-title">9 –õ–∏—Ü–µ–π</div>
        </div>
        <div class="auth-buttons" id="authButtons">
            <button class="auth-btn login-btn" onclick="showModal('loginModal')">–í—Ö–æ–¥</button>
            <button class="auth-btn register-btn" onclick="showModal('registerModal')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
        <div class="auth-buttons" id="userButtons" style="display: none;">
            <span style="color: white; margin-right: 10px;" id="userNameDisplay"></span>
            <button class="auth-btn user-btn" onclick="showMyProfile()">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
            <button class="auth-btn register-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
        </div>
    </div>

    <div class="admin-hidden" onclick="showModal('adminPasswordModal')"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2>–í—Ö–æ–¥</h2>
            <div class="form-group">
                <label>–ò–º—è:</label>
                <input type="text" id="loginName" placeholder="–ò–º—è —É—á–µ–Ω–∏–∫–∞">
            </div>
            <div class="form-group">
                <label>–ö–ª–∞—Å—Å:</label>
                <select id="loginGrade">
                    <option value="1">1 –∫–ª–∞—Å—Å</option>
                    <option value="2">2 –∫–ª–∞—Å—Å</option>
                    <option value="3">3 –∫–ª–∞—Å—Å</option>
                    <option value="4">4 –∫–ª–∞—Å—Å</option>
                    <option value="5">5 –∫–ª–∞—Å—Å</option>
                    <option value="6">6 –∫–ª–∞—Å—Å</option>
                    <option value="7">7 –∫–ª–∞—Å—Å</option>
                    <option value="8">8 –∫–ª–∞—Å—Å</option>
                    <option value="9">9 –∫–ª–∞—Å—Å</option>
                    <option value="10">10 –∫–ª–∞—Å—Å</option>
                    <option value="11">11 –∫–ª–∞—Å—Å</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn" onclick="closeModal('loginModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="login()">–í–æ–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <div class="modal" id="registerModal">
        <div class="modal-content">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <div class="form-group">
                <label>–ò–º—è:</label>
                <input type="text" id="registerName" placeholder="–ò–º—è —É—á–µ–Ω–∏–∫–∞">
            </div>
            <div class="form-group">
                <label>–ö–ª–∞—Å—Å:</label>
                <select id="registerGrade">
                    <option value="1">1 –∫–ª–∞—Å—Å</option>
                    <option value="2">2 –∫–ª–∞—Å—Å</option>
                    <option value="3">3 –∫–ª–∞—Å—Å</option>
                    <option value="4">4 –∫–ª–∞—Å—Å</option>
                    <option value="5">5 –∫–ª–∞—Å—Å</option>
                    <option value="6">6 –∫–ª–∞—Å—Å</option>
                    <option value="7">7 –∫–ª–∞—Å—Å</option>
                    <option value="8">8 –∫–ª–∞—Å—Å</option>
                    <option value="9">9 –∫–ª–∞—Å—Å</option>
                    <option value="10">10 –∫–ª–∞—Å—Å</option>
                    <option value="11">11 –∫–ª–∞—Å—Å</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn" onclick="closeModal('registerModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>
    </div>

    <div class="modal" id="adminPasswordModal">
        <div class="modal-content">
            <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn" onclick="closeModal('adminPasswordModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="checkAdminPassword()">–í–æ–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <div class="modal" id="profileModal">
        <div class="modal-content" style="max-width: 600px;">
            <h2 id="profileModalTitle">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div id="profileContent"></div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn" onclick="closeModal('profileModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addMemeModal">
        <div class="modal-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –º–µ–º</h2>
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                <input type="text" id="memeCategory" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—á–∏—Ç–µ–ª—è">
            </div>
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="memeDescription" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –º–µ–º"></textarea>
            </div>
            <div class="form-group">
                <label>–§–∞–π–ª:</label>
                <input type="file" id="memeFile" accept="image/*,video/*">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn" onclick="closeModal('addMemeModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="addMeme()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="adminModal">
        <div class="modal-content" style="max-width: 800px;">
            <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>

            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('users')">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button class="admin-tab" onclick="switchAdminTab('votes')">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</button>
                <button class="admin-tab" onclick="switchAdminTab('memes')">–ú–µ–º—ã</button>
                <button class="admin-tab" onclick="switchAdminTab('addVote')">–î–æ–±–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</button>
            </div>

            <div id="adminUsers">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                <button class="btn btn-primary" onclick="loadUsers()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ò–º—è</th>
                            <th>–ö–ª–∞—Å—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="usersList"></tbody>
                </table>
            </div>

            <div id="adminVotes" style="display: none;">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è–º–∏</h3>
                <button class="btn btn-primary" onclick="loadAdminVotes()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="adminVotesList"></tbody>
                </table>
            </div>

            <div id="adminMemes" style="display: none;">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–º–∞–º–∏</h3>
                <button class="btn btn-primary" onclick="loadAdminMemes()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–õ–∞–π–∫–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="adminMemesList"></tbody>
                </table>
            </div>

            <div id="adminAddVote" style="display: none;">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h3>
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="voteCategory" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ—É—á—à–∏–π –ø—Ä–æ–µ–∫—Ç">
                </div>
                <div class="form-group">
                    <label>–§–æ—Ç–æ 1:</label>
                    <input type="file" id="votePhoto1" accept="image/*">
                </div>
                <div class="form-group">
                    <label>–§–æ—Ç–æ 2:</label>
                    <input type="file" id="votePhoto2" accept="image/*">
                </div>
                <div class="form-group">
                    <label>–§–æ—Ç–æ 3:</label>
                    <input type="file" id="votePhoto3" accept="image/*">
                </div>
                <button class="btn btn-primary" onclick="addVote()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <div style="margin-top: 20px; text-align: right;">
                <button class="btn" onclick="closeModal('adminModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="hero-section">
            <h1 class="hero-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ 9 –õ–∏—Ü–µ–π</h1>
            <p class="hero-subtitle">–®–∫–æ–ª—å–Ω—ã–π –ø–æ—Ä—Ç–∞–ª –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤ –∏ —É—á–∏—Ç–µ–ª–µ–π</p>

            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3 class="feature-title">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h3>
                    <p class="feature-description">–£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ —à–∫–æ–ª—å–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è—Ö</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üòÇ</div>
                    <h3 class="feature-title">–ú–µ–º—ã</h3>
                    <p class="feature-description">–î–µ–ª–∏—Ç–µ—Å—å —Å–º–µ—à–Ω—ã–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üë•</div>
                    <h3 class="feature-title">–ü—Ä–æ—Ñ–∏–ª–∏</h3>
                    <p class="feature-description">–°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥—Ä—É–≥–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤</p>
                </div>
            </div>
        </div>

        <h2 class="section-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h2>
        <div id="homeVotes" class="votes-grid"></div>

        <h2 class="section-title">–°–≤–µ–∂–∏–µ –º–µ–º—ã</h2>
        <div id="homeMemes" class="memes-grid"></div>
    </div>

    <div id="notification" class="notification" style="display: none;"></div>

    <script>
        let currentUser = null;
        let isAdmin = false;

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function register() {
            const name = document.getElementById('registerName').value;
            const grade = document.getElementById('registerGrade').value;

            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è', 'error');
                return;
            }

            try {
                const response = await fetch(`/users/register?name=${encodeURIComponent(name)}&grade=${grade}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                    closeModal('registerModal');
                    document.getElementById('registerName').value = '';
                } else {
                    const error = await response.json();
                    showNotification(error.detail || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        async function login() {
            const name = document.getElementById('loginName').value;
            const grade = document.getElementById('loginGrade').value;

            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è', 'error');
                return;
            }

            try {
                const response = await fetch(`/users/login?name=${encodeURIComponent(name)}&grade=${grade}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    const user = await response.json();
                    currentUser = user;

                    document.getElementById('authButtons').style.display = 'none';
                    document.getElementById('userButtons').style.display = 'flex';
                    document.getElementById('userNameDisplay').textContent = `${user.name} (${user.grade}–∫–ª)`;

                    showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.name}!`, 'success');
                    closeModal('loginModal');
                    document.getElementById('loginName').value = '';

                    loadHomeVotes();
                    loadHomeMemes();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('authButtons').style.display = 'flex';
            document.getElementById('userButtons').style.display = 'none';
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
            loadHomeVotes();
            loadHomeMemes();
        }

        async function showProfile(userId) {
            try {
                const response = await fetch(`/users/profile/${userId}`);
                const profile = await response.json();

                document.getElementById('profileModalTitle').textContent = `–ü—Ä–æ—Ñ–∏–ª—å: ${profile.name}`;

                let votesHtml = '';
                if (profile.votes && profile.votes.length > 0) {
                    votesHtml = '<h3>–£—á–∞—Å—Ç–∏–µ –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è—Ö:</h3><ul style="list-style: none; padding: 0;">';
                    profile.votes.forEach(vote => {
                        votesHtml += `<li style="padding: 5px 0; border-bottom: 1px solid #eee;">üìä ${vote.category} - –≤–∞—Ä–∏–∞–Ω—Ç ${vote.photo_choice} (${new Date(vote.created_at).toLocaleDateString()})</li>`;
                    });
                    votesHtml += '</ul>';
                } else {
                    votesHtml = '<p>–ü–æ–∫–∞ –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è—Ö</p>';
                }

                document.getElementById('profileContent').innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 80px; height: 80px; background: #e74c3c; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; margin: 0 auto 10px;">
                            ${profile.name.charAt(0).toUpperCase()}
                        </div>
                        <h3>${profile.name}</h3>
                        <p>${profile.grade} –∫–ª–∞—Å—Å</p>
                        <p style="color: #7f8c8d;">ID: ${profile.id}</p>
                    </div>
                    ${votesHtml}
                `;

                showModal('profileModal');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è', 'error');
            }
        }

        function showMyProfile() {
            if (currentUser) {
                showProfile(currentUser.user_id);
            }
        }

        async function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;

            try {
                const response = await fetch('/admin/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password })
                });

                if (response.ok) {
                    isAdmin = true;
                    closeModal('adminPasswordModal');
                    showAdminPanel();
                } else {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        function showAdminPanel() {
            if (!isAdmin) return;
            loadUsers();
            loadAdminVotes();
            loadAdminMemes();
            showModal('adminModal');
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.getElementById('adminUsers').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('adminVotes').style.display = tab === 'votes' ? 'block' : 'none';
            document.getElementById('adminMemes').style.display = tab === 'memes' ? 'block' : 'none';
            document.getElementById('adminAddVote').style.display = tab === 'addVote' ? 'block' : 'none';
        }

        async function loadUsers() {
            try {
                const response = await fetch('/users/all_users');
                const users = await response.json();

                const tbody = document.getElementById('usersList');
                tbody.innerHTML = '';

                users.forEach(user => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td><span class="user-link" onclick="showProfile(${user.id})">${user.name}</span></td>
                        <td>${user.grade}</td>
                        <td><button class="btn btn-danger" onclick="deleteUser(${user.id})">–£–¥–∞–ª–∏—Ç—å</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;

            try {
                const response = await fetch(`/users/delete_users?id=${userId}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω', 'success');
                    loadUsers();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        async function loadHomeVotes() {
            try {
                const response = await fetch('/vote/get_votes');
                const votes = await response.json();

                const container = document.getElementById('homeVotes');
                container.innerHTML = '';

                votes.forEach(vote => {
                    const voteCard = document.createElement('div');
                    voteCard.className = 'vote-card';

                    let photosHtml = '';
                    for (let i = 1; i <= 3; i++) {
                        const photoPath = vote[`photo${i}_path`];
                        photosHtml += `
                            <div class="vote-photo-item">
                                <img src="/${photoPath}" alt="–í–∞—Ä–∏–∞–Ω—Ç ${i}">
                                <button class="vote-button" onclick="castVote(${vote.id}, ${i})" ${!currentUser ? 'disabled' : ''}>
                                    –í–∞—Ä–∏–∞–Ω—Ç ${i}
                                </button>
                            </div>
                        `;
                    }

                    let resultsHtml = '<div class="vote-results">';
                    for (let i = 1; i <= 3; i++) {
                        const count = vote.results[i] || 0;
                        const percent = vote.total_votes > 0 ? (count / vote.total_votes * 100).toFixed(1) : 0;
                        resultsHtml += `
                            <div>–í–∞—Ä–∏–∞–Ω—Ç ${i}: ${count} (${percent}%)</div>
                            <div class="vote-results-bar" style="width: ${percent}%"></div>
                        `;
                    }
                    resultsHtml += `<div>–í—Å–µ–≥–æ: ${vote.total_votes}</div></div>`;

                    voteCard.innerHTML = `
                        <div class="vote-title">${vote.category}</div>
                        <div class="vote-photos">${photosHtml}</div>
                        ${resultsHtml}
                    `;

                    container.appendChild(voteCard);
                });

                if (votes.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π</p>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π:', error);
            }
        }

        async function castVote(voteId, choice) {
            if (!currentUser) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }

            try {
                const response = await fetch(`/vote/${voteId}/vote?photo_choice=${choice}&user_id=${currentUser.user_id}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showNotification('–ì–æ–ª–æ—Å —É—á—Ç–µ–Ω!', 'success');
                    loadHomeVotes();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        async function loadHomeMemes() {
            try {
                const response = await fetch('/memes/all');
                const memes = await response.json();

                const container = document.getElementById('homeMemes');
                container.innerHTML = '';

                memes.slice(0, 6).forEach(meme => {
                    const memeCard = document.createElement('div');
                    memeCard.className = 'meme-card';

                    const isVideo = meme.url.match(/\.(mp4|webm|avi|mov)$/i);

                    const mediaHtml = isVideo ?
                        `<video src="${meme.url}" class="meme-media" controls></video>` :
                        `<img src="${meme.url}" class="meme-media" alt="–ú–µ–º">`;

                    memeCard.innerHTML = `
                        ${mediaHtml}
                        <div class="meme-info">
                            <div class="meme-category">#${meme.category}</div>
                            <div class="meme-description">${meme.description}</div>
                            <div class="meme-footer">
                                <div>
                                    <span class="user-link" onclick="showProfile(${meme.author_id})">–ê–≤—Ç–æ—Ä</span>
                                </div>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <span>‚ù§Ô∏è <span id="like-count-${meme.id}">${meme.likes}</span></span>
                                    <button class="like-button" onclick="likeMeme(${meme.id})">
                                        –õ–∞–π–∫
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    container.appendChild(memeCard);
                });

                if (currentUser) {
                    const addCard = document.createElement('div');
                    addCard.className = 'meme-card add-meme-card';
                    addCard.onclick = () => showModal('addMemeModal');
                    addCard.innerHTML = '<div style="text-align: center;"><div style="font-size: 32px;">‚ûï</div><h3>–î–æ–±–∞–≤–∏—Ç—å –º–µ–º</h3></div>';
                    container.appendChild(addCard);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–º–æ–≤:', error);
            }
        }

        async function likeMeme(memeId) {
            if (!currentUser) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }

            try {
                const response = await fetch(`/memes/${memeId}/like?user_id=${currentUser.user_id}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById(`like-count-${memeId}`).textContent = result.likes;
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞', 'error');
            }
        }

        async function addMeme() {
            if (!currentUser) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }

            const category = document.getElementById('memeCategory').value;
            const description = document.getElementById('memeDescription').value;
            const file = document.getElementById('memeFile').files[0];

            if (!category || !description || !file) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch(`/memes/add?category=${encodeURIComponent(category)}&description=${encodeURIComponent(description)}&user_id=${currentUser.user_id}`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showNotification('–ú–µ–º –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    closeModal('addMemeModal');

                    document.getElementById('memeCategory').value = '';
                    document.getElementById('memeDescription').value = '';
                    document.getElementById('memeFile').value = '';

                    loadHomeMemes();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        async function loadAdminVotes() {
            try {
                const response = await fetch('/vote/get_votes');
                const votes = await response.json();

                const tbody = document.getElementById('adminVotesList');
                tbody.innerHTML = '';

                votes.forEach(vote => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${vote.id}</td>
                        <td>${vote.category}</td>
                        <td><button class="btn btn-danger" onclick="deleteVote(${vote.id})">–£–¥–∞–ª–∏—Ç—å</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π', 'error');
            }
        }

        async function deleteVote(voteId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ?')) return;

            try {
                const response = await fetch(`/vote/delete_votes?id=${voteId}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showNotification('–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
                    loadAdminVotes();
                    loadHomeVotes();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        async function addVote() {
            const category = document.getElementById('voteCategory').value;
            const photo1 = document.getElementById('votePhoto1').files[0];
            const photo2 = document.getElementById('votePhoto2').files[0];
            const photo3 = document.getElementById('votePhoto3').files[0];

            if (!category || !photo1 || !photo2 || !photo3) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('photo1', photo1);
            formData.append('photo2', photo2);
            formData.append('photo3', photo3);

            try {
                const response = await fetch(`/vote/add_votes?category=${encodeURIComponent(category)}`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showNotification('–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ', 'success');

                    document.getElementById('voteCategory').value = '';
                    document.getElementById('votePhoto1').value = '';
                    document.getElementById('votePhoto2').value = '';
                    document.getElementById('votePhoto3').value = '';

                    loadAdminVotes();
                    loadHomeVotes();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        async function loadAdminMemes() {
            try {
                const response = await fetch('/memes/all');
                const memes = await response.json();

                const tbody = document.getElementById('adminMemesList');
                tbody.innerHTML = '';

                memes.forEach(meme => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${meme.id}</td>
                        <td>${meme.category}</td>
                        <td>${meme.description}</td>
                        <td>${meme.likes}</td>
                        <td><button class="btn btn-danger" onclick="deleteMeme(${meme.id})">–£–¥–∞–ª–∏—Ç—å</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–º–æ–≤', 'error');
            }
        }

        async function deleteMeme(memeId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –º–µ–º?')) return;

            try {
                const response = await fetch(`/memes/delete/${memeId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showNotification('–ú–µ–º —É–¥–∞–ª–µ–Ω', 'success');
                    loadAdminMemes();
                    loadHomeMemes();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadHomeVotes();
            loadHomeMemes();
        });
    </script>
</body>
</html>